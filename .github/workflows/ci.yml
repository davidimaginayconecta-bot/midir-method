name: CI

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -l {0}   # activa conda en cada step
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup conda env (mamba)
        uses: conda-incubator/setup-miniconda@v3
        with:
          activate-environment: midir-method
          environment-file: env.yml
          auto-activate-base: false
          use-mamba: true
          python-version: "3.10"

      - name: Show environment
        run: |
          which python
          python -V
          conda info
          conda list | head -n 20

      - name: Sanity imports
        run: |
          python -c "import importlib; [importlib.import_module(m) for m in ['src.io.loader','src.sed.models','src.fit.bic','src.score.iwi','src.vetting.tree']]; print('Imports OK')"

      - name: Run demo notebook (nbconvert)
        run: |
          python -m jupyter nbconvert --to notebook --execute \
            --ExecutePreprocessor.timeout=900 --inplace notebooks/N00_demo_lite.ipynb
